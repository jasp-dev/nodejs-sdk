var LitePayment=function(){"use strict";var e="https://js.stripe.com/v3",t=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,n=null,r=function(r){return null!==n||(n=new Promise((function(n,o){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe)n(window.Stripe);else try{var i=function(){for(var n=document.querySelectorAll('script[src^="'.concat(e,'"]')),r=0;r<n.length;r++){var o=n[r];if(t.test(o.src))return o}return null}();i&&r||i||(i=function(t){var n=t&&!t.advancedFraudSignals?"?advancedFraudSignals=false":"",r=document.createElement("script");r.src="".concat(e).concat(n);var o=document.head||document.body;if(!o)throw new Error("Expected document.body not to be null. requires a <body> element.");return o.appendChild(r),r}(r)),i.addEventListener("load",(function(){window.Stripe?n(window.Stripe):o(new Error("not available"))})),i.addEventListener("error",(function(){o(new Error("Failed to load Stripe.js"))}))}catch(e){return void o(e)}else n(null)}))),n},o=Promise.resolve().then((function(){return r(null)}));o.catch((function(e){}));return class{stripe;config;defaultConfig={appearance:{theme:"flat",variables:{fontFamily:' "Gill Sans", sans-serif',fontLineHeight:"1.5",borderRadius:"10px",colorBackground:"#F6F8FA",accessibleColorOnColorPrimary:"#262626"},rules:{".Block":{backgroundColor:"var(--colorBackground)",boxShadow:"none",padding:"12px"},".Input":{padding:"12px"},".Input:disabled, .Input--invalid:disabled":{color:"lightgray"},".Tab":{padding:"10px 12px 8px 12px",border:"none"},".Tab:hover":{border:"none",boxShadow:"0px 1px 1px rgba(0, 0, 0, 0.03), 0px 3px 7px rgba(18, 42, 66, 0.04)"},".Tab--selected, .Tab--selected:focus, .Tab--selected:hover":{border:"none",backgroundColor:"#fff",boxShadow:"0 0 0 1.5px var(--colorPrimaryText), 0px 1px 1px rgba(0, 0, 0, 0.03), 0px 3px 7px rgba(18, 42, 66, 0.04)"},".Label":{fontWeight:"500"}}},options:{},targetElement:"#payment-element",submitButtonElement:"#submit",paymentFormElement:"#payment-form",clientSecret:"",returnUrl:"",amount:0,currency:""};constructor(e){this.config={...this.defaultConfig,...e}}async handlePayment(){try{await this.loadStripe(),await this.createPaymentElement(this.config.clientSecret)}catch(e){console.error(e)}}async handleReturn(){try{if(await this.loadStripe(),!this.stripe)throw new Error("stripe not loaded");const e=new URL(window.location).searchParams.get("payment_intent_client_secret")??"";if(""!=e){const{error:t,paymentIntent:n}=await this.stripe.retrievePaymentIntent(e);if(t)throw console.log(t.message),new Error("failed to retrieve payment intent");console.log(`Payment ${n.status}: ${n.id}`)}}catch(e){console.error(e)}}async getPublishableKey(){return"pk_test_51NGPvbIDRRkZv7f9k0RnNh88RJg6LgIXwrpYnfU6HNP12RCdbBGWk73TuHVtX3popYDcDtGrxAU5mJ8BKG4Y42vL00TNQafAWy"}async loadStripe(){if("object"==typeof this.stripe)return;const e=await this.getPublishableKey(),t=await function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=Date.now();return o.then((function(e){return function(e,t,n){if(null===e)return null;var r=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"2.1.11",startTime:t})}(r,n),r}(e,t,r)}))}(e,{apiVersion:"2023-10-16"});if(null===t)throw new Error("failed to load stripe");this.stripe=t}async getClientSecret(e,t){const n={amount:e,currency:t},r=await fetch("/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),{error:o,clientSecret:i}=await r.json();return o&&console.log(o.message),i}async createPaymentElement(e){if(!this.stripe)throw new Error("stripe not loaded");""==e&&(e=await this.getClientSecret(this.config.amount,this.config.currency));const t=this.stripe.elements({clientSecret:e,appearance:this.config.appearance});t.create("payment",this.config.options).mount(this.config.targetElement);const n=document.querySelector(this.config.paymentFormElement);if(n){let e=!1;n.addEventListener("submit",(async r=>{if(r.preventDefault(),e)return;e=!0;const o=n.querySelector(this.config.submitButtonElement);if(o&&Object.hasOwnProperty("disabled")&&(o.disabled=!0),this.stripe){const{error:r}=await this.stripe.confirmPayment({elements:t,confirmParams:{return_url:this.config.returnUrl}});if(r){console.log(r.message);const t=document.getElementById("error-message");t&&(t.innerHTML=r.message??""),e=!1;const o=n.querySelector(this.config.submitButtonElement);return void(o&&Object.hasOwnProperty("disabled")&&(o.disabled=!1))}}}))}}}}();
